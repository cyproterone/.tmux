#!/usr/bin/env -S -- bash -Eeuo pipefail -O dotglob -O failglob -O globstar

if ! [[ -v TMUX ]]; then
  exit
fi

if ! [[ -v SSH_CLIENT ]]; then
  exit
fi

MD5="$(md5sum --binary <<<"$TMUX")"
MD5="${MD5% *}"

DIR='/tmp/tmux-status-line'
IP="${SSH_CLIENT% *}"
NAME="$DIR/$MD5"

mkdir --parents -- "$DIR"
printf -- '%s' "$IP" >"$NAME.ip2"
mv -- "$NAME.ip2" "$NAME.ip"
